AWSTemplateFormatVersion: '2010-09-09'
Description: 'CloudFormation template that sets up permissions and events to invoke a Lambda function that checks Spot Placement Score every hour.'

Resources:
  LambdaInvokePermission:
    Type: "AWS::Lambda::Permission"
    Properties:
      Action: "lambda:InvokeFunction"
      FunctionName: "LambdaSpotPlacementScore"
      Principal: "events.amazonaws.com"

  SpotPlacementScoreCheckEventRule:
    Type: "AWS::Events::Rule"
    Properties:
      Description: "Event Rule to invoke Lambda function to check Spot Placement Score every 1 hour."
      ScheduleExpression: "rate(60 minutes)"
      State: "ENABLED"
      Targets:
        - Arn: !Sub "arn:aws:lambda:us-east-1:${AWS::AccountId}:function:LambdaSpotPlacementScore"
          Id: "SpotPlacementScoreCheckTarget"
